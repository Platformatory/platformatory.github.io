<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <!-- Google Tag Manager -->
    <script>
      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, "script", "dataLayer", "GTM-5CR3MF9");
    </script>
    <!-- End Google Tag Manager -->
    <title>
      {% if page.title %}{{page.title}} {% endif %} | {{ site.title | escape }}
    </title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="icon"
      type="image/svg"
      href="{{ '/images/logo/plf-logo.svg' | relative_url }}"
    />
    <!--link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet"-->
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Titillium+Web&display=swap"
      rel="stylesheet"
    />
    <link href="{{ '/assets/css/style.css' | relative_url }}" rel="stylesheet">
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    {% if page.description %}
    <meta name="description" content="{{ page.description }}" />
    {% endif %}
    <meta property="og:title" content="{{ page.title }} | {{site.title}}" />
    <meta property="og:type" content="{{ site.seo.meta_og_type }}" />
    <meta
      property="og:url"
      content="{{site.url}}{{ page.url | split: '/' | join: '/' }}"
    />
    <meta property="og:image" content="{{site.url}}/{{ page.intro_image }}" />
    <meta
      property="og:description"
      content="{{page.description}}"
    />
    <meta name="twitter:card" content="{{ site.seo.meta_twitter_card  }}" />
    <meta name="twitter:site" content="{{ site.seo.meta_twitter_site }}" />
    <meta
      name="twitter:creator"
      content="{{ site.seo.meta_twitter_creator }}"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Reveal.js style -->
    <link
      rel="stylesheet"
      href="{{ '/assets/reveal.js/dist/reveal.css' | relative_url }}"
    />
    <link
      rel="stylesheet"  
      href="{{ '/assets/reveal.js/dist/theme/black.css' | relative_url }}"
      id="theme"
    />
  </head>

  <body>
    {% include v2-main-menu-mobile.html %}
        {% include v2_header.html headerClass='header-extra' %}
        <div class="reveal home-page">
            <div class="slides">
                {{ content }}
            </div>
        </div>
        <div class="home-footer">
            {% include v2_footer.html %} 
          </div>       
    <script type="text/javascript" src="{{ "/assets/js/scripts.js" | relative_url }}""></script>
    <script src="{{ '/assets/reveal.js/dist/reveal.js' | relative_url }}"></script>
    <script src="{{ '/assets/js/monitor.js' | relative_url }}"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
    <script>
      Reveal.initialize({
            hash: true,
            view: "scroll",
            scrollProgress: true,
            scrollActivationWidth: null,
        })
    let hash = window.location.hash
    Reveal.on("ready",(event)=>{
      window.location.hash = hash
    })
    Reveal.on('slidechanged', (event) => {
      // event.previousSlide, event.currentSlide, event.indexh, event.indexv
          if (event.currentSlide.id.length>0){
          const hash=`#/${event.currentSlide.id }`
          window.location.hash = hash;
          }else{
            history.replaceState(null, null,window.location.pathname)
          }
    });
    
    </script>
    <script>
      // Configuration: Set your base pixel URL and Pixel ID here
      const BASE_PIXEL_URL = ' https://test.com/';
      // const PIXEL_ID = 'your_pixel_id';
    
      // Function to send data to your custom pixel
      function sendToPixel(data) {
        const pixelUrl = `${BASE_PIXEL_URL}`;
        // ?pixel_id=${PIXEL_ID}
        const payload = JSON.stringify(data);
    
        // Attempt to use sendBeacon first, falling back to fetch and XMLHttpRequest
        if (navigator.sendBeacon) {
          navigator.sendBeacon(pixelUrl, payload);
        } else if (window.fetch) {
          fetch(pixelUrl, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: payload
          });
        } else {
          const xhr = new XMLHttpRequest();
          xhr.open('POST', pixelUrl, true);
          xhr.setRequestHeader('Content-Type', 'application/json');
          xhr.send(payload);
        }
      }
    
      // 1. Wrap `gtag` to intercept event data
      const originalGtag = window.gtag;
      window.gtag = function() {
        const args = Array.from(arguments);
    
        // Only intercept 'event' type calls
        if (args[0] === 'event') {
          console.log('Intercepted gtag event:', args);
          sendToPixel(args); // Forward to custom pixel
        }
    
        // Continue with the original gtag function
        originalGtag.apply(this, args);
      };
    
      // 2. Wrap `sendBeacon` to intercept GA data
      const originalSendBeacon = navigator.sendBeacon;
      navigator.sendBeacon = function(url, data) {
        if (url.includes('google-analytics.com')) {
          console.log('Intercepted GA beacon data:', data);
          sendToPixel({ url, data });
        }
        return originalSendBeacon.apply(this, arguments);
      };
    
      // 3. Wrap `fetch` to intercept GA data
      const originalFetch = window.fetch;
      window.fetch = function(url, options) {
        if (url.includes('google-analytics.com')) {
          console.log('Intercepted GA fetch data:', options?.body);
          sendToPixel({ url, data: options?.body });
        }
        return originalFetch.apply(this, arguments);
      };
    
      // 4. Wrap `XMLHttpRequest` to intercept GA data
      const originalXHROpen = XMLHttpRequest.prototype.open;
      XMLHttpRequest.prototype.open = function(method, url) {
        if (url.includes('google-analytics.com')) {
          this.isGARequest = true;
        }
        originalXHROpen.apply(this, arguments);
      };
    
      const originalXHRSend = XMLHttpRequest.prototype.send;
      XMLHttpRequest.prototype.send = function(data) {
        if (this.isGARequest) {
          console.log('Intercepted GA XHR data:', data);
          sendToPixel({ url: this.responseURL, data });
        }
        originalXHRSend.apply(this, arguments);
      };
    </script>
    {% include google-analytics.html %}
  </body>
</html>
